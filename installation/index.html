<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installation | Cryb Setup Guide</title>
    <meta name="generator" content="VuePress 1.8.3">
    
    <meta name="description" content="My setup guide for Cryb">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.05592006.css" as="style"><link rel="preload" href="/assets/js/app.0b306c27.js" as="script"><link rel="preload" href="/assets/js/2.802e7773.js" as="script"><link rel="preload" href="/assets/js/7.2397b83f.js" as="script"><link rel="prefetch" href="/assets/js/3.098b0752.js"><link rel="prefetch" href="/assets/js/4.936a7847.js"><link rel="prefetch" href="/assets/js/5.3c153593.js"><link rel="prefetch" href="/assets/js/6.2a69c010.js"><link rel="prefetch" href="/assets/js/8.ef2aa3d2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05592006.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cryb Setup Guide</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <ul class="color-theme-options"><li><a href="#" class="default-theme"></a></li> <li><a href="#" class="blue-theme"></a></li><li><a href="#" class="red-theme"></a></li><li><a href="#" class="purple-theme"></a></li></ul> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <!----> <!----></div></div></div> <!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/installation/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Installation
</a></div> <a href="https://github.com/D3SOX/cryb-guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/installation/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Installation
</a></div> <a href="https://github.com/D3SOX/cryb-guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Installation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/installation/#yarn-repo" class="sidebar-link">Yarn Repo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/#ubuntu-server-20-04-lts" class="sidebar-link">Ubuntu Server 20.04 LTS</a></li><li class="sidebar-sub-header"><a href="/installation/#fedora-server-33" class="sidebar-link">Fedora Server 33</a></li></ul></li><li><a href="/installation/#install-dependencies" class="sidebar-link">Install dependencies</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/#ubuntu-server-20-04-lts-2" class="sidebar-link">Ubuntu Server 20.04 LTS</a></li><li class="sidebar-sub-header"><a href="/installation/#fedora-server-33-2" class="sidebar-link">Fedora Server 33</a></li></ul></li><li><a href="/installation/#firewall-rules" class="sidebar-link">Firewall rules</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#info" class="sidebar-link">Info</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#create-discord-application" class="sidebar-link">Create Discord Application</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#clone-repositories" class="sidebar-link">Clone repositories</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#setup-api" class="sidebar-link">Setup API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#setup-web" class="sidebar-link">Setup Web</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#create-docker-network" class="sidebar-link">Create Docker network</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#setup-portals" class="sidebar-link">Setup Portals</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#setup-janus" class="sidebar-link">Setup Janus</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#setup-portal" class="sidebar-link">Setup Portal</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/installation/#start-everything" class="sidebar-link">Start everything</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/#start-api" class="sidebar-link">Start API</a></li><li class="sidebar-sub-header"><a href="/installation/#start-web" class="sidebar-link">Start Web</a></li><li class="sidebar-sub-header"><a href="/installation/#start-portals" class="sidebar-link">Start Portals</a></li><li class="sidebar-sub-header"><a href="/installation/#start-janus" class="sidebar-link">Start Janus</a></li><li class="sidebar-sub-header"><a href="/installation/#start-a-portal-manually" class="sidebar-link">Start a portal manually</a></li></ul></li><li><a href="/installation/#setup-reverse-proxy" class="sidebar-link">Setup reverse proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/#dns" class="sidebar-link">DNS</a></li><li class="sidebar-sub-header"><a href="/installation/#install-stuff" class="sidebar-link">Install stuff</a></li><li class="sidebar-sub-header"><a href="/installation/#run-certbot" class="sidebar-link">Run certbot</a></li><li class="sidebar-sub-header"><a href="/installation/#edit-nginx-config" class="sidebar-link">Edit nginx config</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h1> <p>Cryb requires a Redis and a MongoDB server, NodeJS, Yarn and Docker.</p> <h2 id="yarn-repo"><a href="#yarn-repo" class="header-anchor">#</a> Yarn Repo</h2> <p>First we add the yarn repo</p> <h3 id="ubuntu-server-20-04-lts"><a href="#ubuntu-server-20-04-lts" class="header-anchor">#</a> Ubuntu Server 20.04 LTS</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> -sL https://dl.yarnpkg.com/debian/pubkey.gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;deb https://dl.yarnpkg.com/debian/ stable main&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/yarn.list
$ <span class="token function">sudo</span> <span class="token function">apt</span> update
</code></pre></div><h3 id="fedora-server-33"><a href="#fedora-server-33" class="header-anchor">#</a> Fedora Server 33</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> --silent --location https://dl.yarnpkg.com/rpm/yarn.repo <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/yum.repos.d/yarn.repo
</code></pre></div><h2 id="install-dependencies"><a href="#install-dependencies" class="header-anchor">#</a> Install dependencies</h2> <h3 id="ubuntu-server-20-04-lts-2"><a href="#ubuntu-server-20-04-lts-2" class="header-anchor">#</a> Ubuntu Server 20.04 LTS</h3> <p>Then we install the dependencies. We also install <code>screen</code> to run it in the background later on.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt</span> remove cmdtest
$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mongodb redis-server docker.io <span class="token function">yarn</span> <span class="token function">git</span> <span class="token function">screen</span>
</code></pre></div><h3 id="fedora-server-33-2"><a href="#fedora-server-33-2" class="header-anchor">#</a> Fedora Server 33</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/yum.repos.d/mongodb.repo</span>
[mongodb-4.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc
EOF</span>
$ <span class="token function">sudo</span> dnf -y <span class="token function">install</span> dnf-plugins-core
$ <span class="token function">sudo</span> dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
$ <span class="token function">sudo</span> dnf <span class="token function">install</span> mongodb-org redis docker-ce docker-ce-cli containerd.io <span class="token function">yarn</span> <span class="token function">git</span> <span class="token function">screen</span>
</code></pre></div><h2 id="firewall-rules"><a href="#firewall-rules" class="header-anchor">#</a> Firewall rules</h2> <p>If you're using firewalld, you must add these rules</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> firewall-cmd --permanent --zone<span class="token operator">=</span>docker --change-interface<span class="token operator">=</span>br0
$ <span class="token function">sudo</span> firewall-cmd --permanent --zone<span class="token operator">=</span>docker --add-port<span class="token operator">=</span><span class="token number">5353</span>/udp
$ <span class="token function">sudo</span> firewall-cmd --permanent --zone<span class="token operator">=</span>docker --add-port<span class="token operator">=</span><span class="token number">45917</span>/udp
$ <span class="token function">sudo</span> firewall-cmd --permanent --zone<span class="token operator">=</span>docker --add-port<span class="token operator">=</span><span class="token number">8888</span>/udp
$ <span class="token function">sudo</span> firewall-cmd --permanent --zone<span class="token operator">=</span>docker --add-port<span class="token operator">=</span><span class="token number">51515</span>/udp
$ <span class="token function">sudo</span> firewall-cmd --permanent --zone<span class="token operator">=</span>docker --add-port<span class="token operator">=</span><span class="token number">42311</span>/udp
</code></pre></div><h2 id="info"><a href="#info" class="header-anchor">#</a> Info</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In the following replace <code>YOURDOMAIN</code>. You may want to use a subdomain like <code>cryb.example.org</code> or your main domain <code>example.org</code></p></div> <h2 id="create-discord-application"><a href="#create-discord-application" class="header-anchor">#</a> Create Discord Application</h2> <p>Since login works via Discord you need you create a Discord application.<br>
Visit the <a href="https://discord.com/developers/applications" target="_blank" rel="noopener noreferrer">Discord Developer Portal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to do so.</p> <ul><li>Click on <code>New application</code> and give it a name.</li> <li>Then copy and save the <code>Client ID</code> and <code>Client Secret</code> (You will need them later)</li> <li>Now go to <code>OAuth2</code> and a <code>Redirect</code> <ul><li>If you plan on using a <a href="/installation/#setup-reverse-proxy">reverse proxy</a> just add <code>https://YOURDOMAIN/auth/discord</code></li> <li>Otherwise, add <code>http://YOURDOMAIN:3000/auth/discord</code></li></ul></li></ul> <h2 id="clone-repositories"><a href="#clone-repositories" class="header-anchor">#</a> Clone repositories</h2> <p>Create a directory and clone all required repositories</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> cryb
<span class="token builtin class-name">cd</span> cryb
<span class="token function">git</span> clone https://github.com/crybapp/api.git
<span class="token function">git</span> clone https://github.com/crybapp/web.git
<span class="token function">git</span> clone https://github.com/crybapp/portals.git
<span class="token function">git</span> clone https://github.com/crybapp/portal.git
<span class="token function">git</span> clone https://github.com/crybapp/janus-docker.git
</code></pre></div><h2 id="setup-api"><a href="#setup-api" class="header-anchor">#</a> Setup API</h2> <p>Move into the <code>api</code> directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> api
</code></pre></div><p>Install dependencies</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span>
</code></pre></div><p>Rename environment file and edit</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mv</span> .env.example .env
<span class="token function">nano</span> .env
</code></pre></div><p>Set</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">NODE_ENV</span><span class="token punctuation">=</span><span class="token value attr-value">production</span>
<span class="token key attr-name">JWT_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">bigcrybfan</span>
<span class="token key attr-name">MONGO_URI</span><span class="token punctuation">=</span><span class="token value attr-value">mongodb://localhost:27017/cryb</span>
<span class="token key attr-name">PORTALS_API_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">thinkingwithportals</span>
<span class="token key attr-name">REDIS_URI</span><span class="token punctuation">=</span><span class="token value attr-value">redis://localhost:6379</span>
</code></pre></div><p>For Discord, we set</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">DISCORD_CLIENT_ID</span><span class="token punctuation">=</span><span class="token value attr-value">&lt;Your client ID here&gt;</span>
<span class="token key attr-name">DISCORD_CLIENT_SECRET</span><span class="token punctuation">=</span><span class="token value attr-value">&lt;Your client secret here&gt;</span>
</code></pre></div><ul><li>If you plan on using a <a href="/installation/#setup-reverse-proxy">reverse proxy</a> set
<ul><li><code>DISCORD_OAUTH_ORIGINS=https://YOURDOMAIN</code></li> <li><code>DISCORD_CALLBACK_URL=https://YOURDOMAIN/auth/discord</code></li></ul></li> <li>Otherwise, set
<ul><li><code>DISCORD_OAUTH_ORIGINS=http://YOURDOMAIN:3000</code></li> <li><code>DISCORD_CALLBACK_URL=http://YOURDOMAIN:3000/auth/discord</code></li></ul></li></ul> <h2 id="setup-web"><a href="#setup-web" class="header-anchor">#</a> Setup Web</h2> <p>Move into the <code>web</code> directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> web
</code></pre></div><p>Install dependencies</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span>
</code></pre></div><p>Rename environment file and edit</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mv</span> .env.example .env
<span class="token function">nano</span> .env
</code></pre></div><p>Set</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">NODE_ENV</span><span class="token punctuation">=</span><span class="token value attr-value">production</span>
<span class="token key attr-name">COOKIE_DOMAIN</span><span class="token punctuation">=</span><span class="token value attr-value">.YOURDOMAIN</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Important: you need that <code>.</code> in front of <code>YOURDOMAIN</code></p></div> <ul><li>If you plan on using a <a href="/installation/#setup-reverse-proxy">reverse proxy</a> set
<ul><li><code>API_WS_URL=wss://YOURDOMAIN/apiws</code></li> <li><code>API_BASE_URL=https://YOURDOMAIN/api</code></li> <li><code>WEB_BASE_URL=https://YOURDOMAIN</code></li> <li><code>JANUS_URL=https://YOURDOMAIN/janus</code></li></ul></li> <li>Otherwise, set
<ul><li><code>API_WS_URL=ws://YOURDOMAIN:4000</code></li> <li><code>API_BASE_URL=http://YOURDOMAIN:4000</code></li> <li><code>WEB_BASE_URL=http://YOURDOMAIN:3000</code></li> <li><code>JANUS_URL=http://YOURDOMAIN:8088</code></li></ul></li></ul> <h2 id="create-docker-network"><a href="#create-docker-network" class="header-anchor">#</a> Create Docker network</h2> <p>We will create a docker network for the portals communication</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> network create -d bridge --subnet <span class="token number">192.168</span>.0.0/24 --gateway <span class="token number">192.168</span>.0.1 portalnet
</code></pre></div><h2 id="setup-portals"><a href="#setup-portals" class="header-anchor">#</a> Setup Portals</h2> <p>Move into the <code>portals</code> directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> portals
</code></pre></div><p>Install dependencies</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span>
</code></pre></div><p>Rename environment file and edit</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mv</span> .env.example .env
<span class="token function">nano</span> .env
</code></pre></div><p>Set</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">NODE_ENV</span><span class="token punctuation">=</span><span class="token value attr-value">production</span>
<span class="token key attr-name">MONGODB_URI</span><span class="token punctuation">=</span><span class="token value attr-value">mongodb://localhost:27017/cryb</span>
<span class="token key attr-name">REDIS_URI</span><span class="token punctuation">=</span><span class="token value attr-value">redis://localhost:6379</span>
<span class="token key attr-name">API_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">thinkingwithportals</span>
<span class="token key attr-name">PORTAL_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">ilikeportals</span>
<span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">docker</span>
<span class="token key attr-name">DOCKER_SOCK</span><span class="token punctuation">=</span><span class="token value attr-value">/var/run/docker.sock</span>
<span class="token key attr-name">DOCKER_IMAGE</span><span class="token punctuation">=</span><span class="token value attr-value">cryb/portal</span>
<span class="token key attr-name">DOCKER_SHM_SIZE</span><span class="token punctuation">=</span><span class="token value attr-value">1024</span>
<span class="token key attr-name">DOCKER_NETWORK</span><span class="token punctuation">=</span><span class="token value attr-value">portalnet</span>
<span class="token key attr-name">ENABLE_JANUS</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">JANUS_HOSTNAME</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span>
<span class="token key attr-name">JANUS_STREAMING_ADMIN_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">supersecret</span>
<span class="token key attr-name">JANUS_PORT</span><span class="token punctuation">=</span><span class="token value attr-value">8088</span>
</code></pre></div><h2 id="setup-janus"><a href="#setup-janus" class="header-anchor">#</a> Setup Janus</h2> <p>Move into the <code>janus-docker</code> directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> janus-docker
</code></pre></div><p>Rename config files</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> configs
<span class="token function">mv</span> janus.jcfg.example janus.jcfg
<span class="token function">mv</span> janus.plugin.streaming.jcfg.example janus.plugin.streaming.jcfg
<span class="token function">mv</span> janus.transport.http.jcfg.example janus.transport.http.jcfg
</code></pre></div><p>Edit streaming config</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">nano</span> janus.plugin.streaming.jcfg
</code></pre></div><p>Uncomment <code>#admin_key = &quot;supersecret&quot;</code> under <code>general</code></p> <p>Go back and build docker image</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token function">docker</span> build <span class="token builtin class-name">.</span> -t cryb/janus
</code></pre></div><h2 id="setup-portal"><a href="#setup-portal" class="header-anchor">#</a> Setup Portal</h2> <p>Move into the <code>portal</code> directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> portal
</code></pre></div><p>Install dependencies</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span>
</code></pre></div><p>Rename environment file and edit</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mv</span> .env.example .env
<span class="token function">nano</span> .env
</code></pre></div><p>Set</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">NODE_ENV</span><span class="token punctuation">=</span><span class="token value attr-value">production</span>
<span class="token key attr-name">PORTALS_WS_URL</span><span class="token punctuation">=</span><span class="token value attr-value">ws://192.168.0.1:5000</span>
<span class="token key attr-name">STREAMING_URL</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.0.1</span>
<span class="token key attr-name">PORTALS_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">ilikeportals</span>
</code></pre></div><p>Build docker image</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> docker:build
</code></pre></div><h2 id="start-everything"><a href="#start-everything" class="header-anchor">#</a> Start everything</h2> <h3 id="start-api"><a href="#start-api" class="header-anchor">#</a> Start API</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> cryb/api
<span class="token function">screen</span> -S cryb-api
<span class="token function">yarn</span> build <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> start
</code></pre></div><h3 id="start-web"><a href="#start-web" class="header-anchor">#</a> Start Web</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> cryb/web
<span class="token function">screen</span> -S cryb-web
<span class="token function">yarn</span> build <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> start
</code></pre></div><h3 id="start-portals"><a href="#start-portals" class="header-anchor">#</a> Start Portals</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> cryb/portals
<span class="token function">screen</span> -S cryb-portals
<span class="token function">yarn</span> build <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> start
</code></pre></div><h3 id="start-janus"><a href="#start-janus" class="header-anchor">#</a> Start Janus</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> cryb/janus-docker
<span class="token function">docker</span> run --rm --name cryb-janus -it --net<span class="token operator">=</span>host -d cryb/janus
</code></pre></div><h3 id="start-a-portal-manually"><a href="#start-a-portal-manually" class="header-anchor">#</a> Start a portal manually</h3> <p>If you've set <code>DRIVER=docker</code> in the <code>portals/.env</code> portals should automatically start. If you want you can set it to <code>manual</code> and start them manually.
Look into the <code>cryb-portals</code> output for the ID (just the numbers) and start a portal:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> cryb/portal
<span class="token function">yarn</span> docker:dev --portalId <span class="token operator">&lt;</span>Portal-ID<span class="token operator">&gt;</span>
</code></pre></div><h2 id="setup-reverse-proxy"><a href="#setup-reverse-proxy" class="header-anchor">#</a> Setup reverse proxy</h2> <p>Now we'll setup a reverse proxy which enables everything to run with SSL and on the root of your domain.</p> <h3 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h3> <p>Add an <code>A</code> entry with the IP of your VPS, and a (sub)domain which you chose earlier.
<img src="data:image/png;base64,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" alt="DNS Setup"></p> <h3 id="install-stuff"><a href="#install-stuff" class="header-anchor">#</a> Install stuff</h3> <p>For this we will install nginx and certbot</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx certbot python3-certbot-nginx
</code></pre></div><h3 id="run-certbot"><a href="#run-certbot" class="header-anchor">#</a> Run certbot</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> certbot --nginx -d YOURDOMAIN
</code></pre></div><h3 id="edit-nginx-config"><a href="#edit-nginx-config" class="header-anchor">#</a> Edit nginx config</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/sites-available/default
</code></pre></div><p>Replace the <code>location /</code> section with</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /api</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:4000</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">rewrite</span>    /api/(.*) /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /apiws</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:4000</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;Upgrade&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /janus</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:8088</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">rewrite</span>    /janus/(.*) /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Restart nginx</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> nginx restart
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/1/2022, 8:08:50 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0b306c27.js" defer></script><script src="/assets/js/2.802e7773.js" defer></script><script src="/assets/js/7.2397b83f.js" defer></script>
  </body>
</html>
